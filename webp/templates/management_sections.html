<head>
    <title>Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
</head>
<button data-drawer-target="sidebar-multi-level-sidebar" data-drawer-toggle="sidebar-multi-level-sidebar"
    aria-controls="sidebar-multi-level-sidebar" type="button"
    class="ms-3 mt-2 inline-flex items-center rounded-lg p-2 text-sm text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 sm:hidden dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600">
    <span class="sr-only">Open sidebar</span>
    <svg class="h-6 w-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
        <path clip-rule="evenodd" fill-rule="evenodd"
            d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z">
        </path>
    </svg>
</button>

<aside id="sidebar-multi-level-sidebar" class="fixed left-0 top-0 z-40 h-screen w-64 -translate-x-full transition-transform sm:translate-x-0" aria-label="Sidebar">
    <div class="h-full overflow-y-auto bg-gray-50 px-3 py-4 dark:bg-gray-800">
      <ul class="space-y-2 font-medium">
        <li>
          <a href="{{ url_for('management') }}" class="group flex items-center rounded-lg p-1 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">
            <svg class="h-[25px] w-[25px] text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M11.293 3.293a1 1 0 0 1 1.414 0l6 6 2 2a1 1 0 0 1-1.414 1.414L19 12.414V19a2 2 0 0 1-2 2h-3a1 1 0 0 1-1-1v-3h-2v3a1 1 0 0 1-1 1H7a2 2 0 0 1-2-2v-6.586l-.293.293a1 1 0 0 1-1.414-1.414l2-2 6-6Z" clip-rule="evenodd" />
            </svg>
  
            <span class="ms-3">Home</span>
          </a>
        </li>
        <li>
          <a href="../dashboard/" class="group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">
            <svg class="h-5 w-5 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 21">
              <path d="M16.975 11H10V4.025a1 1 0 0 0-1.066-.998 8.5 8.5 0 1 0 9.039 9.039.999.999 0 0 0-1-1.066h.002Z" />
              <path d="M12.5 0c-.157 0-.311.01-.565.027A1 1 0 0 0 11 1.02V10h8.975a1 1 0 0 0 1-.935c.013-.188.028-.374.028-.565A8.51 8.51 0 0 0 12.5 0Z" />
            </svg>
            <span class="ms-3">Dashboard</span>
          </a>
        </li>
        <li>
          <button type="button" class="group flex w-full items-center rounded-lg p-2 text-base text-gray-900 transition duration-75 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700" aria-controls="dropdown-example" data-collapse-toggle="dropdown-example">
            <svg class="h-5 w-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 18">
              <path d="M6.143 0H1.857A1.857 1.857 0 0 0 0 1.857v4.286C0 7.169.831 8 1.857 8h4.286A1.857 1.857 0 0 0 8 6.143V1.857A1.857 1.857 0 0 0 6.143 0Zm10 0h-4.286A1.857 1.857 0 0 0 10 1.857v4.286C10 7.169 10.831 8 11.857 8h4.286A1.857 1.857 0 0 0 18 6.143V1.857A1.857 1.857 0 0 0 16.143 0Zm-10 10H1.857A1.857 1.857 0 0 0 0 11.857v4.286C0 17.169.831 18 1.857 18h4.286A1.857 1.857 0 0 0 8 16.143v-4.286A1.857 1.857 0 0 0 6.143 10Zm10 0h-4.286A1.857 1.857 0 0 0 10 11.857v4.286c0 1.026.831 1.857 1.857 1.857h4.286A1.857 1.857 0 0 0 18 16.143v-4.286A1.857 1.857 0 0 0 16.143 10Z" />
            </svg>
            <span class="ms-3 flex-1 whitespace-nowrap text-left rtl:text-right">Manage Data</span>
            <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4" />
            </svg>
          </button>
          <ul id="dropdown-example" class="hidden space-y-2 py-2">
            <li>
              <a href="{{ url_for('table', dataset_name='sales') }}" class="group flex w-full items-center rounded-lg p-2 pl-11 text-gray-900 transition duration-75 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">Sales</a>
            </li>
            <li>
              <a href="{{ url_for('table', dataset_name='products') }}" class="group flex w-full items-center rounded-lg p-2 pl-11 text-gray-900 transition duration-75 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">Products</a>
            </li>
            <li>
              <a href="{{ url_for('table', dataset_name='inventory') }}" class="group flex w-full items-center rounded-lg p-2 pl-11 text-gray-900 transition duration-75 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">Inventory</a>
            </li>
            <li>
              <a href="{{ url_for('table', dataset_name='stores') }}" class="group flex w-full items-center rounded-lg p-2 pl-11 text-gray-900 transition duration-75 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700">Stores</a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </aside>
  


<body>
    <div class="p-4 sm:ml-64">
        <h1 class="font-bold text-3xl pb-4 text-center">Displaying {{ dataset_name.capitalize() }} Data</h1>
        <table id="dataTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    {% for column in columns %}
                    <th>{{ column.name }}</th>
                    {% endfor %}
                </tr>
            </thead>
        </table>

        <!-- Add Data Form -->
        <h2 class="mt-4 font-bold text-center pb-4 text-2xl">Add New Data</h2>
        <form id="add_data" method="POST" action="/api/add/{{ dataset_name }}">
            <div class="flex flex-row justify-center items-center">
                {% for column in columns %}
                <div class="ml-4 mb-6">
                    <label for="{{ column.name }}" class="mb-2 block text-sm font-medium text-gray-900">
                        {{ column.label if column.label else column.name }}
                    </label>
                    <input type="{{ column.type }}" id="{{ column.name }}" name="{{ column.name }}"
                        class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500" />
                </div>
                {% endfor %}
                <div class="ml-4">
                    <button type="submit"
                        class="hover:cursor-pointer text-white bg-blue-700 rounded-lg text-sm text-center font-medium hover:bg-blue-800 px-2 py-2">
                        Add Data
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
        // Function to handle $ formatting for cost and price
        function addDollarFormatting(input) {
            input.addEventListener("input", function (e) {
                let value = e.target.value;
    
                // Remove non-numeric characters except periods
                value = value.replace(/[^0-9.]/g, "");
    
                // Add the $ symbol at the beginning
                if (value) {
                    e.target.value = `$${value}`;
                } else {
                    e.target.value = "$"; // Default to $ if input is cleared
                }
            });
    
            input.addEventListener("blur", function (e) {
                // Format the value with two decimal places on blur
                let value = e.target.value.replace(/[^0-9.]/g, "");
                if (value) {
                    e.target.value = `$${parseFloat(value).toFixed(2)}`;
                } else {
                    e.target.value = "$0.00"; // Default value
                }
            });
        }
    
        // Attach the functionality to both Product_Cost and Product_Price
        const costInput = document.getElementById("Product_Cost");
        const priceInput = document.getElementById("Product_Price");
        if (costInput) addDollarFormatting(costInput);
        if (priceInput) addDollarFormatting(priceInput);
    });
    
        $(document).ready(function () {
            const datasetName = "{{ dataset_name }}";
    
            // Initialize DataTable
            const table = $('#dataTable').DataTable({
                processing: true,
                serverSide: true,
                ajax: `/api/data/${datasetName}`,
                columns: [
                    {% for column in columns %}
                    { data: "{{ column.name }}" },
                    {% endfor %}
                ]
            });
    
            // Handle form submission for adding data
            $('#add_data').on('submit', function (e) {
                e.preventDefault(); // Prevent the form from submitting normally
    
                const formData = $(this).serialize(); // Serialize form data
    
                $.ajax({
                    url: $(this).attr('action'), // The action URL from the form
                    method: 'POST',
                    data: formData,
                    success: function (response) {
                        if (response.success) {
                            alert(response.success);
                            table.ajax.reload(); // Reload the DataTable
                        } else if (response.error) {
                            alert("Error: " + response.error);
                        }
                    },
                    error: function (xhr) {
                        alert("An error occurred: " + xhr.responseText);
                    }
                });
            });
        });
    </script>
</body>
</html>
